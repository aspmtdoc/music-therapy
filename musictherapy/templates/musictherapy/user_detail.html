<!DOCTYPE html>
{% load template_getattr %}
{% load crispy_forms_tags %}
<html>
    <head>
        {% include 'musictherapy/component/header.html' %}
    </head>

    <body>
        <div class="row" style="padding-left: 2%">
            <div class="col-md-10">
                <h1>{{userinfo.name}} - Session: {{session.date.date}}</h1>
            </div>
            <div class="col-md-2">
                <a class="btn btn-info pull-right" href="{% url 'musictherapy:logout' %}" style="margin:5px">Logout</a>
                <a class="btn btn-info pull-right" href="{% url 'musictherapy:list' %}" style="margin:5px">Home</a>
            </div>
        </div>
        <div class="page-wrapper">
            <ul class ="nav nav-tabs" id="tabs">
                <li {% if tab == "info" %} class="active" {% endif %}><a data-toggle="tab" data-target="#basicinfo">Basic Information</a></li>
                {% if musical_pref_form %}
                <li {% if tab == "musicpref" %} class="active" {% endif %}><a data-toggle="tab" data-target="#musicpref">Musical Preference</a></li>
                {% endif %}
                {% if sessions %}
                <li {% if tab == "sessions" %} class="active" {% endif %}><a data-toggle="tab" data-target="#pastsessions">Past Sessions</a></li>
                {% endif %}
                {% if goals or session_goals %}
                <li {% if tab == "goals" %} class="active" {% endif %}><a data-toggle="tab" data-target="#sessiongoals">Treatment Plan</a></li>
                {% endif %}
                {% if data %}
                <li {% if tab == "summary" %} class="active" {% endif %}><a data-toggle="tab" data-target="#summary">Summary</a></li>
                <li {% if tab == "com" %} class="active" {% endif %}><a data-toggle="tab" data-target="#com">Communication Skills</a></li>
                <li {% if tab == "pss" %} class="active" {% endif %}><a data-toggle="tab" data-target="#pss">Psycho-Social Skills</a></li>
                <li {% if tab == "phy" %} class="active" {% endif %}><a data-toggle="tab" data-target="#phy">Physical Skills</a></li>
                <li {% if tab == "cog" %} class="active" {% endif %}><a data-toggle="tab" data-target="#cog">Cognitive and Memory Skills</a></li>
                <li {% if tab == "aff" %} class="active" {% endif %}><a data-toggle="tab" data-target="#aff">Affective Skills</a></li>
                <li {% if tab == "mus" %} class="active" {% endif %}><a data-toggle="tab" data-target="#mus">Music Skills</a></li>
                {% endif %}
            </ul>

            <div class="tab-content forms-wrapper">
                <div id="sessiongoals" class="tab-pane fade {% if tab == "goals" %} in active {% endif %}">
                    {% if goals %}
                    <div class="col-lg-4">
                        {% include "musictherapy/component/goals.html" with goals=goals user=userinfo redirect="goals" %}
                    </div>
                    <div class="col-lg-8">
                        {% include "musictherapy/component/session_goals.html" with data=data user=userinfo redirect="goals" %}
                    </div>
                    {% endif %}
                </div>

                <div id ="musicpref" class="tab-pane fade {% if tab == "musicpref" %} in active {% endif %}">
                    {% if musical_pref_form %}
                        {% crispy musical_pref_form %}

                        {% if musical_pref %}
                        <br>
                        <h4>Last updated {{ musical_pref.updated }}</h4>
                        {% endif %}
                    {% endif %}
                </div>

                <div id="basicinfo" class="tab-pane fade {% if tab == "info" %} in active {% endif %}">
                    {% include 'musictherapy/component/user_info.html' with user=userinfo user_info_form=user_info_form program_form=program_form user_last_updated=user_last_updated %}
                </div>

                <div id="pastsessions" class="tab-pane fade {% if tab == "sessions" %} in active {% endif %}">
                    {% include 'musictherapy/component/session_list.html' with sessions=sessions userinfo=userinfo %}
                </div>

                <div id="summary" class="tab-pane fade {% if tab == "summary" %} in active {% endif %}">
                    {% include 'musictherapy/component/summary.html' with data=data %}
                </div>

                {% for domain, domain_data in data.items %}
                <div id="{{domain}}" class="tab-pane fade {% if tab == domain %} in active {% endif %}">
                    {% include "musictherapy/component/skill.html" with type=domain_data.domain pre=domain data=domain_data user=userinfo %}
                </div>
                {% endfor %}
            </div>
        </div>
    </body>

<script type="text/javascript">
$("#new-program-form").submit(function(e) {
    e.preventDefault();
    $form = $(this);
    var url = $form.attr('action');
    var errorText = $("#new-program-form-error");
    errorText.html('');

    $.ajax({
        type: "POST",
        url: url,
        dataType: 'json',
        data: $("#new-program-form").serialize(),
        success: function(data) {
            if (data == 404) {
                toastr.error("There was a problem saving the program, try again later.");
            } else {
                var label = $('<label class="checkbox"></label>');
                var input = $('<input type="checkbox" name="program">');
                input.attr('value', data["pk"]);
                input.attr('id', "id_program_" + data["pk"]);
                input.attr('checked', 'checked');

                var element = $('#div_id_program div');
                label.append(input);
                label.append(data["display"]);
                element.append(label);
                $('#new-program-modal').modal('toggle');
                toastr.success("Saved new program " + data["display"])
            }
        }
    });
});
</script>


</html>
